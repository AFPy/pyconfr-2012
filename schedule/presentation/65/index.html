
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <link href="/img/favicon.ico" rel="shortcut icon" />
        <title>PyConFR 2012</title>
        <!--  hack to make IE able to apply CSS to elements that it doesn't usually know about. See http://code.google.com/p/html5shim/ -->
        <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        
        
        <link rel="stylesheet" href="/css/facebox.css" />
        <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono" rel="stylesheet" type="text/css">
        <link href="/markitup/skins/simple/style.css" type="text/css" media="screen" rel="stylesheet" />
<link href="/markitup/sets/markdown/style.css" type="text/css" media="screen" rel="stylesheet" />

        
    <!-- Framework CSS -->
<link rel="stylesheet" href="/css/blueprint/grid.css" media="screen, projection" />
<link rel="stylesheet" href="/css/blueprint/print.css" media="print" />
<!--[if lt IE 8]>
<link rel="stylesheet" href="/css/blueprint/ie.css" media="screen, projection" />
<![endif]-->

        
    <link rel="stylesheet" href="/css/reset.css" />
    <link rel="stylesheet" href="/css/pycon.css@6.css" />
    <link rel="stylesheet" href="/css/site_tabs.css@6.css" />
    <link rel="stylesheet" href="/uni_form/uni-form.css" />
    <link rel="alternate" type="application/atom+xml" href="http://www.pycon.fr/2012/feed/general/" title="blog feed"/>
    
    <style>
        a.unbookmark {
            text-decoration: none;
            padding-left: 20px;
            background: url(../../../../2011/site_media/static/img/star_unselected.png.html) no-repeat left;
        }
        a.bookmark {
            text-decoration: none;
            padding-left: 20px;
            background: url(../../../../2011/site_media/static/img/star_unselected.png.html) no-repeat left;
        }
        div.slot {
            font-weight: bold;
        }
    </style>


    </head>

    <body class="full schedule " id="">
        <div class="wrapper">

            <div class="msg-container">
                
            </div>

            <header>
                <div class="container">
                    
                        <h1 id="logo"><a href="../../../index.html">PyConFR 2012</a></h1>
                        
                        <div id="left_tabs"></div>
                        <div id="right_tabs"></div>
                        <div class="login">
    


<div class="account-bar">

    <a href="http://www.pycon.fr/2012/account/login/">Connexion</a>
    ou
    <a href="http://www.pycon.fr/2012/account/signup/">Inscription</a>

</div>
<div class="clear"></div>

</div>
                        
    

<nav id="main-nav">
    <ul>
        <li><a href="../../../about/index.html" id="link-about">À propos</a></li>
        <li><a href="../../../sprints/index.html" id="link-sprints">Sprints</a></li>
        <li><a href="../../../speaker/index.html" id="link-speakers">Conférenciers</a></li>
        <li><a href="../../index.html" id="link-schedule">Agenda</a></li>
        
        
        
        
        <li><a href="../../../venue/index.html" id="link-venue">Lieu</a></li>
        <li><a href="../../../sponsors/index.html" id="link-sponsors">Sponsors</a></li>
        
        
    </ul>
</nav>


                        
                    
                </div>
            </header>

            <!--section id="subnav">
                <div class="container">
                    { block subnav_base }{ block subnav }{ endblock }{ endblock }
                </div>
            </section-->

            
                
                <section id="body">
                    <div class="container">

                        
    
    
    <h1>Manger tout type de données en python avec PyBABE</h1>

    <div class="badges">
        
    </div>

    

    <div class="speakers">
        
            <a href="../../../speaker/profile/53/index.html">Florian Douetteau</a>
        
    </div>
    
    <div class="badges">
        
        <div class="clear"></div>
    </div>

    <dl class="inline mod">
        <dt>Type:</dt>
        <dd>pyconfr</dd>

        <dt>Audience level:</dt>
        <dd>Intermediate</dd>

        <dt>Category:</dt>
        <dd>présentation</dd>
    </dl>
    
    
        <div class="slot">Septembre 15th 5 après-midi &ndash; 5:30 après-midi</div>
    

    <hr />

    <h3>Description</h3>

    <div class="description">PyBabe est un micro framework d&#39;ETL en python. Il permet d&#39;intégrer facilement différents types (csv, excel, zip, ..) et sources de données (filesystem, DB, FTP, HTTP, Amazon S3, Email), d&#39;effectuer des transformations simples sur les données, soit via des primitives ad-hoc, soit via des extensions en python.

  </div>
    
    <hr />

    <h3>Abstract</h3>
    
    <div class="abstract"><p>PyBabe est un micro framework d'ETL en python. Il permet d'intégrer facilement différents types (csv, excel, zip, ..) et sources de données (filesystem, DB, FTP, HTTP, Amazon S3, Email), d'effectuer des transformations simples sur les données, soit via des primitives ad-hoc, soit via des extensions en python.</p>
<p>Le projet est né  dans le cadre d'intégration de logs analytiques d'un éditeur de jeux sociaux. Le volume des logs (30GB par jour), leur diversité (SQL, logs applicatifs, logs apaches, API REST externes etc...) et le besoin de traitement ad-hoc pour contrôler la qualité des données rendait difficile l'utilisation de solutions sur étagère.</p>
<p>Un premier projet utilisant une solution ETL open-source avait été un échéc. Il était clair qu'une solution à la fois souple, agile, simple et efficace dans la manipulation de donnée était nécessaire. L'équipe s'est alors naturellement tournée vers Python !</p>
<p>Un premier développement Python a permis très rapidement d'obtenir des résultats. Cependant pour permettre une meilleur maintenance du code d'intégration, la conception d'un framework a été décidé : ceci a donné naissance à pybabe maintenant open-source. </p>
<p>PyBabe utilise de manière intensive une approche par stream, tirant parti des  namedtuple et des générateurs. Il fournit une bibliothèques de primitives riches. Ainsi pour récupérer un fichier de log compressé de s3, détecter le pays, le navigateur, et le pousser dans une base, le script pybabe ressemble à:<br/>
</p>
<p>## Recupére un fichier CSV de S3, le décompresse, cache en local
   babe = babe.pull(url=“s3://myapp/mydir 2012-07-07_*.csv.gz”,cache=True) </p>
<p>## Recupère l’IP dans le champs IP, trouve pas geoip le pays
   babe = babe.geoip_country_code(field=“ip”, country_code=“country”, ignore_error_True)</p>
<p>## Récupère le user agent, et stocke le nom du navigateur
   babe = babe.user_agent(field=“user_agent”, browser=“browser”) </p>
<p>## Ne garde que les champs pertinents
   babe = babe.filterFields(fields=[“user_id”, “date”, “country”, “user_agent”])</p>
<p>## Stocke le résultat dans une base de donnée 
  babe.push_sql(database=“mydb”, table=“mytable”, username=“…”); </p>
<p>PyBabe permet également d'effectuer des opérations sur de gros volumes de données, pour effectuer certaines opérations de reporting. Ainsi, pour calculer une somme sur un volume d'utilisateur, augmenter le résultat du nom de l'utilisatuer et fabriquer un fichier excel de résultat: </p>
<pre><code>babe = Babe()
 ## Recupére un gros fichier csv 
babe = babe.pull(filename=“mybigfile.csv”)

## Effecture un tri “disk-based”, par paquet de 100.000 lignes
babe = babe.sortDiskBased(field=“uid”, nsize=100000)

## Calcule un regroupement par uid 
## Calcule la somme des revenues par utilisateurs. 
babe = babe.groupBy(field=“uid”, reducer=lambda x, y: (x.uid, x.amount + y.amount))

## Join avec le résultat d’une requete sql pour recupérer des meta information sur les utilisateurs
babe = babe.join(Babe().pull_sql(database=“mydb”, table=“user_info”, “uid”, “uid”)

## Stocke le résultat du rapport dans un fichier Excel !!
</code></pre>
<p>babe.push (filename=“reports.xlxs”); </p>
<p>Le projet PyBabe ne fait que commencer et espère de nouveaux contributeurs ! </p></div>



                    </div>

                </section>
            
            <div class="push"></div>
        </div>

        <footer>
            <div class="container">
    <p>
        PyConFR 2012 est organisé par <a href="http://afpy.org/">l'AFPY</a>.
    <br />
        Site construit par <a href="http://eldarion.com">Eldarion</a> et <a href="http://afpy.org/">l'AFPY</a>
	avec <a href="http://djangoproject.com">Django</a> et <a href="http://pinaxproject.com">Pinax</a>.
   <br />
        Questions ? Commentaires ? Contactez <a href="mailto:orga@pycon.fr">orga@pycon.fr</a>
   <br />
	Forkez moi sur <a href="https://github.com/PyConFr/Pyconfr">Github</a>
    </p>
</div>
        </footer>

        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
        <script src="/js/base.js" type="text/javascript"></script>
        <script src="/uni_form/uni-form.jquery.js" type="text/javascript"></script>
        <script type="text/javascript" src="http://www.pycon.fr/static/markitup/jquery.markitup.js"></script>
        <script type="text/javascript" src="http://www.pycon.fr/static/markitup/sets/markdown/set.js"></script>
        <script src="/js/facebox.js" type="text/javascript"></script>
<script type="text/javascript">
    jQuery(document).ready(function($) {
        $('a[rel*=facebox]').facebox({
            loadingImage: '/img/facebox/loading.gif',
            closeImage: '/img/facebox/closelabel.png'
        });
        $(document).bind('reveal.facebox', function() {
            $("form.in_facebox").submit(function() {
                form = this;
                jQuery.facebox(function($) {
                    fields = jQuery(form).find("input[type='text']").filter(":enabled");
                    params = {}
                    fields.each(function() {
                        params[this.name] = this.value;
                    });
                    jQuery.post(form.action, params,
                        function(data, textStatus) {
                            jQuery.facebox(data);
                        }
                    );
                });
                return false;
            });
        });
        $(document).bind('close.facebox', function() {
           location.reload();
          });
     });
</script>
        <script type="text/javascript" charset="utf-8">
            $(document).ajaxSend(function(event, xhr, settings) {
                function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie != '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = jQuery.trim(cookies[i]);
                            // Does this cookie string begin with the name we want?
                            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }
                function sameOrigin(url) {
                    // url could be relative or scheme relative or absolute
                    var host = document.location.host; // host + port
                    var protocol = document.location.protocol;
                    var sr_origin = '//' + host;
                    var origin = protocol + sr_origin;
                    // Allow absolute or scheme relative URLs to same origin
                    return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
                        (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
                        // or any other URL that isn't scheme relative or absolute i.e relative.
                        !(/^(\/\/|http:|https:).*/.test(url));
                }
                function safeMethod(method) {
                    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                }

                if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
                    xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                }
            });
        </script>
        
        <script type="text/javascript">
            $(document).ready(function($) {
                $("a.boxes-edit-link").click(function() {
                    $.facebox.settings.loadingImage = "/site_media/static/img/loading.gif";
                    $.facebox.settings.closeImage = "/site_media/static/img/closelabel.png";
                    $(document).bind("beforeReveal.facebox", function() {
                        $("#facebox .content").css("width", "600px");
                    });
                    var editable = this;
                    $(document).bind("reveal.facebox", function() {
                        $("#edit_form").submit(function() {
                            $.post(editable.href, $(this).serialize(), function(data) {
                                $(document).trigger("close.facebox");
                                $(editable).load(data);
                                $(document).unbind("reveal.facebox");
                            });
                            return false;
                        });
                    });
                    $.facebox({ajax: this.href});
                    return false;
                });
            });
        </script>
        
        
    <script type="text/javascript" charset="utf-8">
      $(function(){
          $("#id_email").focus();
          $(function () {
              if(('ul#messages').length > 0) {
                  setTimeout(function() {
                      $('ul#messages').fadeOut(3000);
                  }, 2000 );
              }
          });
      });
    </script>
    
    <script type="text/javascript">
        $(document).ready(function() {
            $("a.bookmark").live("click", function() {
                aElem = $(this);
                $.ajax({
                    type: "POST",
                    url: this.href,
                    data: "action=add;csrfmiddlewaretoken=437de46344f9f9588759b74cfa18e9bd",
                    success: function() {
                        aElem.text("unbookmark");
                        aElem.removeClass("bookmark");
                        aElem.addClass("unbookmark");
                    },
                    error: function(xhr, options, error) {
                        alert(xhr.status);
                    }
                });
                return false;
            });
            $("a.unbookmark").live("click", function() {
                aElem = $(this);
                $.ajax({
                    type: "POST",
                    url: this.href,
                    data: "action=delete;csrfmiddlewaretoken=437de46344f9f9588759b74cfa18e9bd",
                    success: function(response) {
                        aElem.text("bookmark");
                        aElem.removeClass("unbookmark");
                        aElem.addClass("bookmark");
                    },
                    error: function(xhr, options, error) {
                        alert(xhr.status);
                    }
                });
                return false;
            });
        });
    </script>


    </body>
</html>
